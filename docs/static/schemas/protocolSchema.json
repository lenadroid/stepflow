{
    "$id": "https://stepflow.org/schemas/protocolSchema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "StepFlow Protocol",
    "oneOf": [
        {
            "$ref": "#/defs/MethodRequest"
        },
        {
            "$ref": "#/defs/MethodResponseSuccess"
        },
        {
            "$ref": "#/defs/MethodResponseError"
        },
        {
            "$ref": "#/defs/Notification"
        }
    ],
    "defs": {
        "MethodRequest": {
            "title": "Method Request",
            "description": "A method request.",
            "type": "object",
            "properties": {
                "jsonrpc": {
                    "type": "string",
                    "const": "2.0",
                    "title": "JSON-RPC Version",
                    "description": "The version of the JSON-RPC protocol."
                },
                "id": {
                    "type": [
                        "string",
                        "integer",
                        "null"
                    ],
                    "title": "Request ID",
                    "description": "The ID of the method request."
                },
                "method": {
                    "type": "string",
                    "title": "Method",
                    "description": "The method being called."
                },
                "params": {
                    "title": "Parameters",
                    "description": "Parameters for the method call. Set on method requests. Not set for notifications.",
                    "oneOf": [
                        {
                            "$ref": "#/defs/InitializeRequest"
                        },
                        {
                            "$ref": "#/defs/ListComponentsRequest"
                        },
                        {
                            "$ref": "#/defs/ComponentInfoRequest"
                        },
                        {
                            "$ref": "#/defs/ComponentExecuteRequest"
                        },
                        {
                            "$ref": "#/defs/StepArgumentsRequest"
                        }
                    ]
                }
            },
            "required": [
                "jsonrpc",
                "id",
                "method",
                "params"
            ]
        },
        "MethodResponseSuccess": {
            "title": "Method Response",
            "description": "A method response with a successful result.",
            "type": "object",
            "properties": {
                "jsonrpc": {
                    "type": "string",
                    "const": "2.0",
                    "title": "JSON-RPC Version",
                    "description": "The version of the JSON-RPC protocol."
                },
                "id": {
                    "type": [
                        "string",
                        "integer",
                        "null"
                    ],
                    "title": "Request ID",
                    "description": "The ID of the method request."
                },
                "result": {
                    "title": "Result",
                    "description": "Result of a method call.",
                    "oneOf": [
                        {
                            "$ref": "#/defs/InitializeResponse"
                        },
                        {
                            "$ref": "#/defs/ListComponentsResponse"
                        },
                        {
                            "$ref": "#/defs/ComponentInfoResponse"
                        },
                        {
                            "$ref": "#/defs/ComponentExecuteResponse"
                        },
                        {
                            "$ref": "#/defs/StepArgumentsResponse"
                        }
                    ]
                }
            },
            "required": [
                "jsonrpc",
                "id",
                "result"
            ]
        },
        "MethodResponseError": {
            "title": "Method Error",
            "description": "A method response with an error.",
            "type": "object",
            "properties": {
                "jsonrpc": {
                    "type": "string",
                    "const": "2.0",
                    "title": "JSON-RPC Version",
                    "description": "The version of the JSON-RPC protocol."
                },
                "id": {
                    "type": [
                        "string",
                        "integer",
                        "null"
                    ],
                    "title": "Request ID",
                    "description": "The ID of the method request."
                },
                "error": {
                    "title": "Error",
                    "description": "Error object",
                    "type": "object",
                    "properties": {
                        "code": {
                            "type": "integer",
                            "title": "Error Code",
                            "description": "A numeric code indicating the error type."
                        },
                        "message": {
                            "type": "string",
                            "title": "Error message.",
                            "description": "Concise, single-sentence description of the error."
                        },
                        "data": {
                            "type": "object",
                            "description": "Primitive or structured value that contains additional information about the error."
                        }
                    },
                    "required": [
                        "code",
                        "message"
                    ]
                }
            },
            "required": [
                "jsonrpc",
                "id",
                "error"
            ]
        },
        "Notification": {
            "type": "object",
            "title": "Notification",
            "description": "Notification sent without requiring a response.",
            "properties": {
                "jsonrpc": {
                    "type": "string",
                    "const": "2.0",
                    "title": "JSON-RPC Version",
                    "description": "The version of the JSON-RPC protocol."
                },
                "method": {
                    "type": "string",
                    "title": "Method",
                    "description": "The notification being sent."
                },
                "params": {
                    "title": "Parameters",
                    "description": "Parameters of the notification.",
                    "oneOf": [
                        {
                            "$ref": "#/defs/InitializedNotification"
                        }
                    ]
                }
            },
            "required": [
                "jsonrpc",
                "method",
                "params"
            ]
        },
        "Component": {
            "type": "string",
            "title": "Component URL",
            "description": "URL identifying a component."
        },
        "InitializeRequest": {
            "title": "initialize Request",
            "description": "Parameters for the initialize method request.",
            "type": "object",
            "properties": {}
        },
        "InitializeResponse": {
            "title": "initialize Response",
            "description": "Result of the initialize method.",
            "type": "object",
            "properties": {}
        },
        "InitializedNotification": {
            "title": "initialized Notification",
            "description": "Notification that initialization is complete.",
            "type": "object",
            "properties": {}
        },
        "ListComponentsRequest": {
            "title": "listComponents Request",
            "description": "Parameters for the listComponents method request.",
            "type": "object",
            "properties": {}
        },
        "ListComponentsResponse": {
            "title": "listComponents Response",
            "description": "Result of the listComponents method.",
            "type": "object",
            "properties": {}
        },
        "ComponentInfoRequest": {
            "title": "componentInfo Request",
            "description": "Parameters for the componentInfo method request.",
            "type": "object",
            "properties": {
                "component": {
                    "$ref": "#/defs/Component"
                }
            },
            "required": [
                "component"
            ]
        },
        "ComponentInfoResponse": {
            "title": "componentInfo Response",
            "description": "Result of the componentInfo method.",
            "type": "object",
            "properties": {
                "metadata": {
                    "type": "object",
                    "properties": {
                        "title": {
                            "type": "string",
                            "description": "Title of the component."
                        },
                        "description": {
                            "type": "string",
                            "description": "Description of the component."
                        },
                        "icon": {
                            "type": "string",
                            "format": "base64",
                            "decription": "Base64 encoded image for the component."
                        }
                    },
                    "required": [
                        "title"
                    ]
                },
                "input_schema": {
                    "$ref": "https://json-schema.org/draft/2020-12/schema",
                    "description": "The schema for the component input."
                },
                "output_schema": {
                    "$ref": "https://json-schema.org/draft/2020-12/schema",
                    "description": "The schema for the component output."
                },
                "hints": {
                    "type": "object",
                    "properties": {
                        "side_effects": {
                            "type": "boolean",
                            "description": "Whether the component has side-effects. If false the component only executes if its output is needed.",
                            "default": true
                        }
                    }
                }
            },
            "required": [
                "metadata",
                "input_schema",
                "output_schema"
            ]
        },
        "ComponentExecuteRequest": {
            "title": "componentExecute Request",
            "description": "Parameters for the componentExecute method request.",
            "type": "object",
            "properties": {
                "workflowId": {
                    "type": "string",
                    "title": "Workflow ID",
                    "format": "uuid",
                    "description": "ID of the workflow being executed."
                },
                "stepId": {
                    "type": "string",
                    "title": "Step ID",
                    "description": "ID of the step being executed."
                },
                "component": {
                    "$ref": "#/defs/Component"
                },
                "input": {
                    "title": "Input",
                    "description": "Input to the component. Must match the component's input schema."
                }
            },
            "required": [
                "workflowId",
                "stepId",
                "component",
                "input"
            ]
        },
        "ComponentExecuteResponse": {
            "title": "componentExecute Response",
            "description": "Result of the componentExecute method.",
            "type": "object",
            "properties": {
                "output": {
                    "title": "Output",
                    "description": "Output from the component. Must match the component's output schema."
                }
            },
            "required": [
                "output"
            ]
        },
        "StepArgumentsRequest": {
            "title": "stepArguments Request",
            "description": "Parameters for the stepArguments method request.",
            "type": "object",
            "properties": {
                "workflowId": {
                    "type": "string",
                    "title": "Workflow ID",
                    "format": "uuid",
                    "description": "ID of the workflow to getarguments for."
                },
                "stepId": {
                    "type": "string",
                    "title": "Step ID",
                    "description": "ID of the step to get arguments for."
                }
            },
            "required": [
                "workflowId",
                "stepId"
            ]
        },
        "StepArgumentsResponse": {
            "title": "stepArguments Response",
            "description": "Result of the stepArguments method.",
            "type": "object",
            "properties": {
                "component": {
                    "$ref": "#/defs/Component"
                },
                "input": {
                    "title": "Input",
                    "description": "Input to the component. Must match the component's input schema."
                }
            }
        }
    }
}